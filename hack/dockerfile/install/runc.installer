#!/bin/sh
set -e

# RUNC_VERSION specifies the version of runc to install from the
# https://github.com/opencontainers/runc repository.
#
# The version of runc should match the version that is used by the containerd
# version that is used. If you need to update runc, open a pull request in
# the containerd project first, and update both after that is merged.
#
# When updating RUNC_VERSION, consider updating runc in vendor.mod accordingly
: "${RUNC_VERSION:=0cf10d4964ba953b0e955f60d727b7c5c09aee1e}"

install_runc() {
	RUNC_BUILDTAGS="${RUNC_BUILDTAGS:-"runc_nodmz"}"

	echo "Install runc version $RUNC_VERSION (build tags: $RUNC_BUILDTAGS)"
	git clone https://github.com/rata/runc.git "$GOPATH/src/github.com/opencontainers/runc"
	cd "$GOPATH/src/github.com/opencontainers/runc"
	git checkout -q "$RUNC_VERSION"
	if [ -z "$1" ]; then
		target=static
	else
		target="$1"
	fi
	make EXTRA_BUILDTAGS="$RUNC_BUILDTAGS" "$target"
	mkdir -p "${PREFIX}"
	cp runc "${PREFIX}/runc"
}
